description: >
  Build and push image to AWS ECR

executor:
  name: << parameters.executor >>
  tag: << parameters.tag >>

parameters:
  executor:
    type: string
    default: "ruby"
    description: "Executor to use. Defaults to 'ruby'."

  tag:
    type: string
    description: "Tag for executor image to use. Defaults to executor default."

  ssm_parameter:
    type: string
    description: SSM Parameter that contains the ECR URL

  environment:
    type: string
    description: Deployment environment, e.g. 'development'

  image_name:
    type: string
    description: Name of the Docker image to build

steps:
  - checkout

  - setup_remote_docker:
      version: 20.10.11
      docker_layer_caching: false

  - aws-cli/install

  - build-and-push:
      ssm_parameter: << parameters.ssm_parameter >>
      image_name: << parameters.image_name >>
      environment: << parameters.environment >>
